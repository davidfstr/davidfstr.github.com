<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    
    <title>Reading Japanese text from images | DaFoster</title>
  
  
    <meta name="author" content="David Foster">
  
  
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://dafoster.net/articles/2014/05/10/reading-japanese-text-from-images-quickly/"
      },
      "headline": "Reading Japanese text from images",
      
      "datePublished": "2014-05-10T00:00:00+00:00",
      "dateModified": "2014-05-10T00:00:00+00:00",
      "author": {
        "@type": "Person",
        "name": "David Foster",
        "image": {
          "@type": "ImageObject",
          "url": "https://dafoster.net/about/profile.jpg"
        }
      },
      "publisher": {
        "@type": "Organization",
        "name": "David Foster",
        "logo": {
          "@type": "ImageObject",
          "url": "https://dafoster.net/about/profile.jpg"
        }
      }
    }
    </script>
  
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml" />
    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml" />
    
  
    <!-- Google Analytics -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18719089-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  

    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Styles -->
    <link rel="preload" href="/assets/bootswatch-readable-3.4.1/raleway/1Ptug8zYS_SKggPNyC0IT4ttDfA.woff2" as="font" crossorigin="anonymous">
    <link rel="stylesheet" href="/assets/bootswatch-readable-3.4.1/bootstrap.min.css">
    
    <link rel="stylesheet" href="/assets/css/style.css" media="all">
    <link rel="stylesheet" href="/assets/css/style-print.css" media="print">
    
    
    
    
      <style>
        
.bad { background-color: pink; }
.good { background-color: MediumSeaGreen; }

/* Make kanji big so that they are legible */
.kanji { font-size: 28px; }

/* Extra spacing between bulleted list items to separate large kanji characters */
.post ul li { line-height: 36px; }

      </style>
    

    <!-- Fav and touch icons -->
    <!-- NOTE: Feed readers only understand favicons at the root of the site. -->
    <link rel="shortcut icon" href="/favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    
    <!-- Scripts -->
  
    <script src="/assets/js/jquery-1.12.4.min.js"></script>
  
  
  
    <script src="/assets/bootstrap-3.4.1/js/bootstrap.min.js"></script>
  
  
  </head>

  <body>

    <nav class="navbar navbar-inverse">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#df-navbar-collapse" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">DaFoster</a>
        </div>
        <div class="navbar-collapse collapse" id="df-navbar-collapse">
          <ul class="nav navbar-nav">
            
              
            
              
                <li><a href="/about/">About</a></li>
              
            
              
            
              
                <li><a href="/articles/">Articles</a></li>
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                <li><a href="/projects/">Projects</a></li>
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
            
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="content-container">
        <!-- Encourage IE 6 users to upgrade their browser. -->
        <!--[if lt IE 7]>
          <div style="clear: both; height: 59px; padding: 0 0 0 50px; position: relative;">
            <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
              <img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg"
                border="0" height="42" width="820"
                alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." />
            </a>
          </div>
        <![endif]-->
        
        
          <div class="row">
  <div class="col-md-12 content post">
    <h1>Reading Japanese text from images</h1>
    <div class="post-metadata">
      
        May 10, 2014
       &ndash; Filed under: 
      <span class="tag_box tag_box--inline">
        
        
          <span><a href="/articles/topics/#Offtopic">Offtopic<sup>6</sup></a></span>
        
      </span>
      
    </div>
    
    <p>I&rsquo;ve been intensively studying Japanese recently<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>, and something I have to do quite a lot is look up Japanese words that I see in images. Particularly words that involve a lot of kanji characters.</p>

<p>Last evening I hacked together a program that allows me to select arbitrary Japanese from an image on my screen, performs optical character recognition (OCR) on it, and outputs it as regular Unicode text. This regular text can then be looked up in an online Japanese-English dictionary, such as the excellent <a href="http://jisho.org/">jisho.org</a>.</p>

<p>Let&rsquo;s take the following sentence:</p>

<p><img src="/assets/2014/kanji.png" alt="Japanese sentence with lots of kanji" /></p>

<p>The first word in that sentence already has 4 kanji characters, which would normally take a long time to look up individually.<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup></p>

<p>With my program, I can take a screenshot of this sentence as it appears on my screen and the program will immediately output the following text:</p>

<ul>
<li><p class="kanji">痴話喧嘩は<span class="bad">維</span>続中か</p></li>
</ul>


<p>Then I can lookup the words as usual from jisho.org&rsquo;s <a href="http://jisho.org/words/">Words</a> search:</p>

<ul>
<li><span class="kanji">痴話喧嘩</span> = lover&rsquo;s quarrel</li>
<li><span class="kanji"><span class="bad">維</span>続</span> = ?</li>
<li><span class="kanji">中</span> = inside; in (a space or building)</li>
</ul>


<p>Character recognition still isn&rsquo;t perfect, as demonstrated by the character marked in <span class="bad">pink</span> above, which wasn&rsquo;t decoded correctly.</p>

<p>Nevertheless even having a partially correct character is useful, as I can still use jisho.org&rsquo;s <a href="http://jisho.org/kanji/">Kanji</a> search to break it down into its component radicals:</p>

<ul>
<li><span class="kanji"><span class="bad">維</span> = <span class="good">小</span> + <span class="good">幺</span> + <span class="good">糸</span> + <span class="bad">隹</span></span></li>
</ul>


<p>And then use a few of the <em>correct</em> radicals in the <a href="http://jisho.org/kanji/radicals/">Kanji by Radicals</a> search to quickly find the correct character:</p>

<ul>
<li><span class="kanji"><span class="good">継</span> = <span class="good">小</span> + <span class="good">幺</span> + <span class="good">糸</span> + ｜ + 米</span></li>
</ul>


<p>And so the original word can now be looked up correctly:</p>

<ul>
<li><span class="kanji"><span class="good">継</span>続</span> = continuation</li>
</ul>


<h2>How it Works</h2>

<p>The program operates by waiting for you to take a screenshot using Command-Shift-4 (on the Mac), observing the new screenshot appearing on the desktop, and feeding it to the <a href="https://code.google.com/p/nhocr/">nhocr</a> tool, which reads the Japanese text inside the screenshot and prints it.</p>

<h2>Source Code</h2>

<pre><code>#!/usr/bin/env python
# 
# nhocr_desktop.py
#
# Waits for screenshots to appear on the desktop,
# scans them for Japanese text using OCR,
# and prints out the text that was decoded from the image.
# 
# This script is useful for rapidly converting on-screen Japanese
# text to actual text that can be looked up.
#
# Prerequisites:
#   * nhocr
#   * ImageMagick
#   * Python 2.7 - maybe 2.6 okay too
#   * watchdog
# 
# @author David Foster
# 

import os.path
import subprocess
import time
from watchdog.observers import Observer
from watchdog.events import FileSystemEventHandler

class ScreenshotFileCreationEventHandler(FileSystemEventHandler):
    def on_created(self, event):
        if not event.is_directory:
            if 'Screen Shot' in os.path.basename(event.src_path):
                # Convert screenshot to PPM format with ImageMagick
                subprocess.check_call([
                    'convert', event.src_path, '/tmp/line.ppm'])

                line = subprocess.check_output([
                    'nhocr', '-line', '/tmp/line.ppm', '-o', '-'])
                print line.decode('utf-8'),

event_handler = ScreenshotFileCreationEventHandler()

observer = Observer()
observer.schedule(event_handler, '/Users/me/Desktop', recursive=False)
observer.start()

print 'Waiting for screenshots on the desktop to analyze...'
try:
    while True:
        time.sleep(1)
except KeyboardInterrupt:
    observer.stop()
observer.join()
</code></pre>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>All this studying is one reason I haven&rsquo;t posted in a while.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>Individual kanji can be looked up by their component radicals at jisho.org&rsquo;s <a href="http://jisho.org/kanji/radicals/">Kanji by Radicals</a> search. Unfortunately it can take a few minutes to lookup each character.<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
</ol>
</div>


  </div>
  
  <div class="col-md-12 block-bar">
    <div class="block">
  <div class="subscribe__prompt">Did you enjoy this article?</div>
  <a class="subscribe" href="https://twitter.com/davidfstr">
  <img src="/assets/twitter-icon-16x16.png" alt="" width="16" height="16" />Subscribe (Twitter)
</a>
<a class="subscribe" href="https://dafoster.net/atom.xml">
  <img src="/assets/feed-icon-14x14.png" alt="" width="14" height="14" />Subscribe (RSS)
</a>
<span class="subscribe subscribe-last subscribe__frequency">
  <i>Updated articles every Tuesday!</i>
</span>

</div>

  </div>
  
  <div class="col-md-12">
    <div style="text-align: center;">
      <ul class="pagination">
      
        <li class="prev"><a href="/articles/2014/02/17/agda-second-impressions/" title="Agda: Second Impressions">&larr; Previous</a></li>
      
        <li><a href="/articles/">Index</a></li>
      
        <li class="next"><a href="/articles/2014/06/24/submitting-a-python-app-to-the-mac-app-store/" title="Submitting a Python App to the Mac App Store">Next &rarr;</a></li>
      
      </ul>
    </div>
    
    
  </div>
</div>

        
      </div>

      <footer>
        <p>&copy; 2021 <a href="/about/">David Foster</a>
        
        </p>
      </footer>

    </div>
    
  
  
  
    
  
    
  
  </body>
</html>
